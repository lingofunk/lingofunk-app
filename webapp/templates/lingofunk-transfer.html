{% extends "base.html" %}
{% set current_page_id = 'transfer' %}
{% block title %}Review Style Transfer{% endblock %}

{% block head %}
<style>
    .output {
        display: none;
    }
</style>
{% endblock %}

{% block body %}
<h2 align="center">Review Style Transferrer</h2>
<fieldset>
    <div class="form-group">
        <form action="{{ url_for('api_transferrer') }}" id="textform" method="post">
            <label for="review">Review:</label>
            <textarea class="display-4 form-control" id="review" name="review" rows="5"
                placeholder="Enter your review.">Went in for a lunch. Steak sandwich was delicious, and the Caesar salad had an absolutely delicious dressing, with a perfect amount of dressing, and distributed perfectly across each leaf. I know I'm going on about the salad... </textarea>
        </form>
    </div>
</fieldset>
<div>
    <button type="submit" id="btn-submit" class="btn btn-success" onclick="onClickSubmit()">
        Transfer
    </button>
    <div class="loader" id="loader"></div>
</div>
<div class="container">
    <div class="output alert alert-success" id="positive-output" name="positive-output-text"></div>
    <div class="output alert alert-danger" id="negative-output" name="negative-output-text"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
const renderTextInStyle = function (text) {
    const url = "api/transferrer";
    $.ajax({
        url: url,
        type: 'POST',
        contentType: 'application/json',
        datatype: 'json',
        data: JSON.stringify({
            text: text
        }),
        success: function (result) {
            console.log(result);
            const parsedResults = JSON.parse(result);
            const isPositive = parsedResults.prediction;
            callTransferrer(text, isPositive);
        }
    });
};

const callTransferrer = function (text, isPositive) {
    const url = "api/transferrer"; // use your endpoint
    $.ajax({
        url: url,
        type: 'POST',
        contentType: 'application/json',
        datatype: 'json',
        data: JSON.stringify({
            text: text
        }),
        success: function (result) {
            console.log(result);
            let parsedResults = JSON.parse(result);
            $('#positive-output').text(parsedResults.positive)
            $('#negative-output').text(parsedResults.negative)
            $('.output').css('display', 'block');
        }
    });
};
const onClickSubmit = function (event) {
    const text = $('#review').val();
    renderTextInStyle(text);
};

$('#review').change(
    () => {
        if (!$('#review').val()) {
            $("#btn-submit").prop("disabled", true);
        } else {
            $("#btn-submit").prop("disabled", false);
        }

    }
);

const spinnerHide = () => {
    $('#loader').css('display', 'none');
};
const spinnerShow = () => {
    $('#loader').css('display', 'inline-block');
};

spinnerHide();

$(document)
    .ajaxStart(function () {
        spinnerShow()
        $("#btn-submit").prop("disabled", true);
    })
    .ajaxStop(function () {
        spinnerHide();
        $("#btn-submit").prop("disabled", false);
    });

</script>
{% endblock %}
